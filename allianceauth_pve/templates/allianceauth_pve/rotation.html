{% extends 'allianceauth/base.html' %}
{% load static %}
{% load evelinks %}
{% load humanize %}

{% block page_title %}Rotation {{ rotation.name }}{% endblock page_title %}
{% block extra_css %}
<style>
    .row-pve {
        display: flex;
    }
    
    .column-pve {
        flex: 50%;
        padding: 10px;
    }
</style>
{% endblock extra_css %}

{% block content %}
    <div class="col-lg-12">
        <h1 class="page-header text-center">{{ rotation.name }}</h1>
        <a href="{% url 'allianceauth_pve:dashboard' %}">Back to dashboard</a>
        <div class="panel panel-default">
            <div class="row-pve">
                <div class="column-pve">
                    {% if rotation.is_closed %}
                        <p class="text-center">Status</p>
                        <p class="text-center"><b>Closed</b></p>
                    {% else %}
                        <p class="text-center">Age</p>
                        <p class="text-center">{{ rotation.days_since }} days</p>
                    {% endif %}
                </div>
                <div class="column-pve">
                    <p class="text-center">Estimated Total</p>
                    <p class="text-center">{{ rotation.estimated_total|floatformat|intcomma }}</p>
                </div>
                {% if rotation.is_closed %}
                <div class="column-pve">
                    <p class="text-center">Actual Total</p>
                    <p class="text-center">{{ rotation.actual_total|floatformat|intcomma }}</p>
                </div>
                {% endif %}
                <div class="column-pve">
                    <p class="text-center">Tax Rate</p>
                    <p class="text-center">{{ rotation.tax_rate|floatformat }} %</p>
                </div>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title text-center">Summary</h3>
            </div>
            <div class="row-pve">
                <div class="column-pve">
                    <table class="table table-aa">
                        <thead>
                            <tr>
                                <th>Character</th>
                                <th>Setups</th>
                                {% if rotation.is_closed %}
                                    <th>Actual Total</th>
                                    <th>Estimated Total</th>
                                {% else %}
                                    <th>Total</th>
                                {% endif %}
                            </tr>
                        </thead>

                        <tbody>
                            {% for row in summary_first %}
                                <tr>
                                    <td>
                                        <img src="{{ row.character|character_portrait_url:32 }}" class="img-circle" style="margin-right: 1rem;">
                                        {{ row.character.character_name }}
                                    </td>
                                    <td>{{ row.helped_setups }}</td>
                                    {% if rotation.is_closed %}
                                        <td>{{ row.actual_total|floatformat|intcomma }}</td>
                                    {% endif %}
                                    <td>{{ row.estimated_total|floatformat|intcomma }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="column-pve">
                    <table class="table table-aa">
                        <thead>
                            <tr>
                                <th>Character</th>
                                <th>Setups</th>
                                {% if rotation.is_closed %}
                                    <th>Actual Total</th>
                                    <th>Estimated Total</th>
                                {% else %}
                                    <th>Total</th>
                                {% endif %}
                            </tr>
                        </thead>

                        <tbody>
                            {% for row in summary_second %}
                                <tr>
                                    <td>
                                        <img src="{{ row.character|character_portrait_url:32 }}" class="img-circle" style="margin-right: 1rem;">
                                        {{ row.character.character_name }}
                                    </td>
                                    <td>{{ row.helped_setups }}</td>
                                    {% if rotation.is_closed %}
                                        <td>{{ row.actual_total|floatformat|intcomma }}</td>
                                    {% endif %}
                                    <td>{{ row.estimated_total|floatformat|intcomma }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% if not rotation.is_closed %}
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title text-center">Entries</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-aa">
                        <thead>
                            <th scope="row">Date</th>
                            <th scope="row">Share Count</th>
                            <th scope="row">Total After Tax</th>
                            <th scope="row">Total</th>
                            <th scope="row">Created By</th>
                            <th></th>
                        </thead>
                        <tbody>
                            {% for entry in entries.all %}
                                <tr>
                                    <td>{{ entry.created_at|date:"d/m/Y G:i e" }}</td>
                                    <td>{{ entry.total_shares_count }}</td>
                                    <td>{{ entry.estimated_total_after_tax|floatformat|intcomma }}</td>
                                    <td>{{ entry.estimated_total|floatformat|intcomma }}</td>
                                    <td>{{ entry.created_by.profile.main_character.character_name }}</td>
                                    <td><a data-toggle="tooltip" data-placement="top" title="Show Details" href="#"><i class="fas fa-chevron-circle-right"></i></a></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <caption><a href="#">Show All</a></caption>
                    </table>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock content %}