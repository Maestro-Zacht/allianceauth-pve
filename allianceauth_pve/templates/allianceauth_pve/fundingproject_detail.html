{% extends 'allianceauth/base.html' %}
{% load humanize %}
{% load evelinks %}
{% load pvefilters %}

{% block page_title %}Funding Project Details{% endblock page_title %}

{% block extra_css %}
    <link href="{% allianceauth_pve_static 'allianceauth_pve/css/double_table.css' %}" rel="stylesheet" type="text/css">
{% endblock extra_css %}

{% block content %}
    <div class="col-lg-12">
        <h1 class="page-header text-center">{{ funding_project.name }}</h1>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title text-center">Funding Project</h3>
            </div>
            <div class="flex-center-horizontal">
                <ul class="list-group list-group-horizontal" style="margin-bottom: 0;">
                    <li class="list-group-item text-center">
                        <p>Started</p>
                        <p>{{ funding_project.created_at|date:"d/m/Y G:i e" }}</p>
                    </li>
                    {% if not funding_project.is_active %}
                    <li class="list-group-item text-center">
                        <p>Completed</p>
                        <p>{{ funding_project.completed_at|date:"d/m/Y G:i e" }}</p>
                        <p>{{ funding_project.completed_in_days }} days</p>
                    </li>
                    {% endif %}
                    <li class="list-group-item text-center">
                        <p>Users</p>
                        <p>{{ funding_project.num_participants }}</p>
                    </li>
                    {% if funding_project.is_active %}
                    <li class="list-group-item text-center">
                        <p>Estimated Total</p>
                        <p>{{ funding_project.estimated_total|intcomma }}</p>
                    </li>
                    {% endif %}
                    <li class="list-group-item text-center">
                        <p>Current Total</p>
                        <p>{{ funding_project.current_total|intcomma }}</p>
                    </li>
                    <li class="list-group-item text-center">
                        <p>Goal</p>
                        <p>{{ funding_project.goal|intcomma }}</p>
                    </li>
                </ul>
            </div>

            <br>
            <div class="panel-body">
                <div class="progress" style="height: 20px;">
                    <div class="progress-bar {% if funding_project.is_active %}progress-bar-striped active{% endif %} {% if funding_project.actual_percentage >= 100 %}progress-bar-success{% elif funding_project.actual_percentage <= 1 %}progress-bar-danger{% elif funding_project.actual_percentage < 25 %}progress-bar-warning{% else %}progress-bar-info{% endif %}" role="progressbar" style="min-width: 1%; width: {{ funding_project.html_actual_percentage_width }}%;" aria-valuenow="{{ funding_project.html_actual_percentage_width }}" aria-valuemin="0" aria-valuemax="100">{{ funding_project.actual_percentage|floatformat }} &percnt;</div>
                    {% if funding_project.is_active %}
                        <div class="progress-bar progress-bar-striped active{% if funding_project.actual_percentage >= 25 %} progress-bar-success{% endif %}" role="progressbar" style="min-width: 1%; width: {{ funding_project.html_estimated_percentage_width }}%;" aria-valuenow="{{ funding_project.html_estimated_percentage_width }}" aria-valuemin="0" aria-valuemax="100">{{ funding_project.estimated_missing_percentage|floatformat }} &percnt;</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title text-center">Contributors</h3>
            </div>
            <div class="panel-body">
                <div class="row-pve">
                    {% for summary in summaries %}
                        <div class="column-pve">
                            <table class="table table-aa">
                                <thead>
                                    <tr>
                                        <th>User's Main Character</th>
                                        {% if funding_project.is_active %}
                                            <th>Estimated Total</th>
                                        {% endif %}
                                        <th>Actual Total</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    {% for row in summary %}
                                        <tr>
                                            <td>
                                                <img src="{{ row.character_id|character_portrait_url:32 }}" class="img-circle" style="margin-right: 1rem;">
                                                {{ row.character_name }}
                                            </td>
                                            {% if funding_project.is_active %}
                                                <td>{{ row.estimated_total|intcomma }}</td>
                                            {% endif %}
                                            <td>{{ row.actual_total|intcomma }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div style="text-align: right; margin: 10px;">
            <a href="{% url 'allianceauth_pve:index' %}" class="btn btn-primary">Back</a>
            {% if perms.allianceauth_pve.manage_funding_projects %}
                <a href="{% url 'allianceauth_pve:project_toggle_complete' funding_project.pk %}" class="btn btn-danger" style="margin-left: 2px;">
                    {% if funding_project.is_active %}
                        Mark As Completed
                    {% else %}
                        Reopen
                    {% endif %}
                </a>
            {% endif %}
        </div>
    </div>
{% endblock content %}